<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Phathom: A Distributed Image Processing Framework for Whole Brain Mapping - Justin Swaney</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://jmswaney.github.io/images/neuron_icon.png" rel="icon">

<link rel="canonical" href="https://jmswaney.github.io/phathom-background.html">

        <meta name="author" content="Justin Swaney" />
        <meta name="keywords" content="phathom,image,processing,brain,mapping" />
        <meta name="description" content="The background and motivation for the phathom python package" />

        <meta property="og:site_name" content="Justin Swaney" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Phathom: A Distributed Image Processing Framework for Whole Brain Mapping"/>
        <meta property="og:url" content="https://jmswaney.github.io/phathom-background.html"/>
        <meta property="og:description" content="The background and motivation for the phathom python package"/>
        <meta property="article:published_time" content="2018-04-02" />
            <meta property="article:section" content="research" />
            <meta property="article:tag" content="phathom" />
            <meta property="article:tag" content="image" />
            <meta property="article:tag" content="processing" />
            <meta property="article:tag" content="brain" />
            <meta property="article:tag" content="mapping" />
            <meta property="article:author" content="Justin Swaney" />
            <meta property="og:image"
                  content="https://jmswaney.github.io/images/hela_cells.jpg"/>

    <meta name="twitter:dnt" content="on">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:domain" content="https://jmswaney.github.io">
            <meta property="twitter:image"
                  content="https://jmswaney.github.io/images/hela_cells.jpg"/>


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://jmswaney.github.io/theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="https://jmswaney.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://jmswaney.github.io/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://jmswaney.github.io/theme/css/style.css" type="text/css"/>





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://jmswaney.github.io/" class="navbar-brand">
<img class="img-responsive pull-left gap-right" src="https://jmswaney.github.io/images/neuron_icon.png" width="30"/>             </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/category/research.html">Research</a></li>
                    <li><a href="/pages/publications.html">Publications</a></li>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/pages/contact.html">Contact</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://jmswaney.github.io/phathom-background.html"
                       rel="bookmark"
                       title="Permalink to Phathom: A Distributed Image Processing Framework for Whole Brain Mapping">
                        Phathom: A Distributed Image Processing Framework for Whole Brain Mapping
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-04-02T22:26:00-04:00"> Mon 02 April 2018</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://jmswaney.github.io/tag/phathom.html">phathom</a>
        /
	<a href="https://jmswaney.github.io/tag/image.html">image</a>
        /
	<a href="https://jmswaney.github.io/tag/processing.html">processing</a>
        /
	<a href="https://jmswaney.github.io/tag/brain.html">brain</a>
        /
	<a href="https://jmswaney.github.io/tag/mapping.html">mapping</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>In this post, I want to explain the motivations behind the creation of <a class="reference external" href="https://github.com/chunglabmit/phathom">Phathom</a> and clearly lay out the problems that it tries to solve. I'll add links to posts on specific parts of Phathom as I continue to develop it.</p>
<div class="section" id="background">
<h2>Background</h2>
<p>Phathom is an image processing project born from the challenges faced when trying to analyze 3D biolgocal images of cleared tissue samples. In the following subsections, I'll provide some background to help understand this context.</p>
<div class="section" id="tissue-clearing">
<h3>Tissue Clearing</h3>
<p>Tissue clearing refers to a set of new tissue processing techniques that render a tissue sample optically transparent. The most well-known clearing technique is <a class="reference external" href="https://www.youtube.com/watch?v=c-NMfp13Uug">CLARITY</a>. CLARITY-processed tissue samples retain all the proteins of the original tissue but are optically transparent, which permits us to visualize them in 3D with conventional light microscopy techniques. In the case of the brain, this removes the need to cut the whole brain into thin sections, preserving all the neuronal connections for 3D imaging. For this reason, CLARITY is most commonly applied to brains, but it can be used to clear other organs as well.</p>
<div class="figure align-center" style="width: 70%">
<img alt="cleared mouse brains" src="images/clarity.jpg" />
<p class="caption">A CLARITY-processed mouse brain from Chung, K. (2013) <em>Nature</em>.</p>
</div>
<p>CLARITY works by removing lipids (including cell membranes) with a detergent. Since the lipids scatter light very effectively, the tissue becomes more transparent when they are removed. Unfortunately, the tissues also become extremely fragile because the membranes add a lot of structural support. CLARITY uses paraformaldehyde (PFA) and an acrylamide hydrogel (which is also clear) to support the tissue through this clearing process. The result is a transparent tissue-hydrogel hybrid that retains the original sample's endogenous proteins and nucleic acids in their original place.</p>
</div>
<div class="section" id="immunostaining">
<h3>Immunostaining</h3>
<p>Since the endogenous proteins and nucleic acids are still present in the cleared sample, they can be 'stained' using conventional dyes, probes, and antibodies. For quick summary on how we hijack antibodies from the immune system to label specific proteins, check out <a class="reference external" href="https://en.wikipedia.org/wiki/Immunohistochemistry">immunohistochemistry</a> (IHC). Here's a quick list of some probes that we use often with cleared brain samples:</p>
<ul class="simple">
<li><strong>DAPI</strong>: DNA / nucleus (dye)</li>
<li><strong>Syto16</strong>: DNA / nucleus (dye)</li>
<li><strong>Lectin</strong>: blood vessels stain (lectin protein)</li>
<li><strong>NeuN</strong>: neurons (antibody)</li>
<li><strong>SMI-312</strong>: neuronal projections (antibody)</li>
<li><strong>Parvalbumin, Calretinin, Calbindin</strong>: interneurons (antibody)</li>
<li><strong>GFAP</strong>: astrocytes (antibody)</li>
<li><strong>Iba1</strong>: microglia (antibody)</li>
<li><strong>Bassoon</strong>: a presynaptic marker (antibody)</li>
<li><strong>Homer1</strong>: a postsynaptic marker (antibody)</li>
</ul>
<p>When we stain and image wth these markers, we can visualize how their targets are spatially dsitributed throughout the brain. Typically, we assign each target a color and overlay them like this:</p>
<div class="figure align-center" style="width: 90%">
<img alt="multicolor immunostaining image" src="images/switch.jpg" />
<p class="caption">A multichannel image resulting from multiple rounds of protein labeleling and imaging. From Murray, E. (2015) <em>Cell</em>.</p>
</div>
<p>While this image is in 2D for presentation, we actually acquire many stacks of 2D images to create a 3D volume. We can do this using confocal microscopy or, if we need to image larger samples, light sheet microscopy.</p>
</div>
<div class="section" id="light-sheet-microscopy">
<h3>Light Sheet Microscopy</h3>
<p>Selective Plane Illumination Microscopy (SPIM) is a light sheet microscopy technique that is much faster than traditional point scanning techniques like confocal microscopy. A SPIM microscope typically consists of at least two microscope objectives positioned perpendicular to each other. The <em>illumination objective</em> is responsible for creating a light sheet by scanning a laser across the sample. The <em>detection objective</em> collects the light emitted from excited fluorophores for multiple cameras to record. After collecting an image at a single plane, either objectives move or the sample itself moves for the next image.</p>
<div class="figure align-center" style="width: 70%">
<img alt="SPIM microscope" src="images/spim.jpg" />
<p class="caption">From the Laser Analytics Group, University of Cambridge.</p>
<div class="legend">
(Left) Illumination objective forming a ligh sheet in the focal plane of the detection objective within a fluorescent solution. (Right) Detection objective collecting light emitted within the fluorescent solution.</div>
</div>
<p>Since the light sheet only excites the focal plane of the detection objective, SPIM limits out-of-focus light collection. This allows us to <em>optically section</em> our cleared tissue samples and stack our 2D images into sharp 3D images. SPIM has other advantages in terms of acquisition speed and limited <em>photobleaching</em> as well.</p>
</div>
</div>
<div class="section" id="motivation">
<h2>Motivation</h2>
<div class="section" id="turning-clarity-into-a-quantitative-technique-for-neuroscience">
<h3>Turning CLARITY into a quantitative technique for neuroscience</h3>
<p>Neuroscientists often use CLARITY to create visually appealing figuresâ€”I've heard some refer to it as a <em>qualitative method for making pretty pictures</em>. That is, CLARITY is rarely used by a broader set of researchers as a central tool through which they study the brain. Several tried-and-true methods in electrophysiology, thin-section IHC, and optogenetics are used for the &quot;heavy-lifting&quot;. I think this is a shame since many of these methods could be complimented quite well with the spatial information that CLARITY provides. So, why isn't this being done?</p>
<p>To take CLARITY from qualitative to quantitative, we need to turn our huge 3D images into some meaningful data. At a very basic level, the data that we are interested in gathering might include the location of every cell in the brain and which of these cells are neurons, glia, etc. It may also include brain region information for each cell (amygdala, VTA, etc). The challenge is to develop to compuational algorithms for extracting this information from large, somewhat noisy images.</p>
<p>If we can provide a tool for extracting meaningful biological information from images of cleared tissues, then CLARITY may be used to quantitatively compare different experimentatl conditions. Since these comparisons would be done with whole brains, the experimental comparisons are less biased than conventional sectioning techniques. One problem with section-based IHC is that researcher already have a brain region in mind when designing experiments. While this makes it easier to confirm your original hypothesis, it limits our ability to see the bigger picture. Using CLARITY quantitatively, we may be able to discover things that we never knew to look for.</p>
</div>
</div>
<div class="section" id="prior-art">
<h2>Prior Art</h2>
<p>Large-scale image analysis is not a new problem in biological image processing. Here are some links to recent advances in the field:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.nature.com/articles/s41593-018-0109-1#Sec10">https://www.nature.com/articles/s41593-018-0109-1#Sec10</a></li>
<li><a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0959438815000756">https://www.sciencedirect.com/science/article/pii/S0959438815000756</a></li>
<li><a class="reference external" href="https://www.nature.com/articles/s41593-017-0027-7">https://www.nature.com/articles/s41593-017-0027-7</a></li>
</ul>
</div>
<div class="section" id="specific-aims-of-phathom">
<h2>Specific Aims of Phathom</h2>
<div class="section" id="aim-1-align-multiple-imaging-rounds-into-a-single-global-coordinate-system">
<h3>Aim 1: Align multiple imaging rounds into a single global coordinate system</h3>
<p>Since we can only image 4 proteins at a particular time, we resort to a multiround staining and imaging approach. However, when we restain the tissue sample and return it to the microscope, we can't return the sample to <em>exactly</em> the same position as the previous imaging round. Therefore, we need a method for aligning multiple rounds of imaging in order to integrate all of the protein expression information into a single multicolor image. Coupled with this aim is the alignment to a <a class="reference external" href="http://mouse.brain-map.org/static/atlas">reference atlas</a> so that we can also know the brain region of each cell.</p>
</div>
<div class="section" id="aim-2-detect-all-cells-within-the-brain">
<h3>Aim 2: Detect all cells within the brain</h3>
<p>As a starting point, we're interested in knowning where all the cells in the brain are. This can serve as a sort of &quot;single-cell atlas&quot; for each brain sample.</p>
</div>
<div class="section" id="aim-3-classify-individual-cell-types-based-on-protein-expression">
<h3>Aim 3: Classify individual cell types based on protein expression</h3>
<p>If we know where all the cells are, we may also be able to classify each cell type based on protein expression information. For example, parvalbumin postive cells may be classified as interneurons, and GFAP positive cells may be classified as astrocytes. By classifying each cell, we can start to compare specific cell populations between experiments.</p>
</div>
</div>
<div class="section" id="discussion">
<h2>Discussion</h2>
<p>There are many challenges when trying to accomplish the above aims. The first is the image size, which can be upwards of 1TB for a single mouse brain. This is larger than a sigle machine's RAM, so we need to process the image in smaller chunks and avoid reading the whole image. The image size also constrains our image processing algorithms since we need to prioirtize low computational complexity. Standard open-source tools like <a class="reference external" href="http://cellprofiler.org/">Cell Profiler</a> are inadequate for this task for many reasons. First, they often assume that the image should be loaded into memory. Second, they are often implemented as a desktop app without the capability of distributed execution. Ideally, Phathom could take advantage of many cores across many nodes in a computing cluster (if they are available). That means that Phathom should come with support for common resource management systems like <a class="reference external" href="https://slurm.schedmd.com/">SLURM</a>.</p>
<p>Lastly, I'll state that visualization is beyond the scope of Phathom. Of course, visualizing the results that Phathom creates would be extremely informative, but we are actually developing a separate tool for visualization. Our visualization tool is called <a class="reference external" href="https://github.com/chunglabmit/nuggt">Nuggt</a> and it is based on <a class="reference external" href="https://github.com/google/neuroglancer">Neuroglancer</a>.</p>
</div>

            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="https://jmswaney.github.io/organoid-intro.html">Neural Organoids: a New Platform for Human Brain Research</a></li>
    </ul>
</section>
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jmswaney-github-io'; // required: replace example with your forum shortname

                var disqus_url = 'https://jmswaney.github.io/phathom-background.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Justin Swaney
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                <p><small>  <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en">Creative Commons Attribution-NonCommercial 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://jmswaney.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://jmswaney.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://jmswaney.github.io/theme/js/respond.min.js"></script>


    <script src="https://jmswaney.github.io/theme/js/bodypadding.js"></script>
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jmswaney-github-io'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->


        <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ac0f7e62eb46c7e"></script>
</body>
</html>
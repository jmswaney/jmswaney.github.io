<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Pystripe: a Python Package for Removing Streaks from Light-Sheet Images - Justin Swaney</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://jmswaney.github.io/images/neuron_icon.png" rel="icon">

<link rel="canonical" href="https://jmswaney.github.io/pystripe-summary.html">

        <meta name="author" content="Justin Swaney" />
        <meta name="keywords" content="pystripe,python,microscopy,light-sheet,SPIM" />
        <meta name="description" content="Pystripe is a new package that can clean up streaky light-sheet images" />

        <meta property="og:site_name" content="Justin Swaney" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Pystripe: a Python Package for Removing Streaks from Light-Sheet Images"/>
        <meta property="og:url" content="https://jmswaney.github.io/pystripe-summary.html"/>
        <meta property="og:description" content="Pystripe is a new package that can clean up streaky light-sheet images"/>
        <meta property="article:published_time" content="2018-05-11" />
            <meta property="article:section" content="research" />
            <meta property="article:tag" content="pystripe" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="microscopy" />
            <meta property="article:tag" content="light-sheet" />
            <meta property="article:tag" content="SPIM" />
            <meta property="article:author" content="Justin Swaney" />
            <meta property="og:image"
                  content="https://jmswaney.github.io/images/hela_cells.jpg"/>

    <meta name="twitter:dnt" content="on">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:domain" content="https://jmswaney.github.io">
            <meta property="twitter:image"
                  content="https://jmswaney.github.io/images/hela_cells.jpg"/>


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://jmswaney.github.io/theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="https://jmswaney.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://jmswaney.github.io/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://jmswaney.github.io/theme/css/style.css" type="text/css"/>





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://jmswaney.github.io/" class="navbar-brand">
<img class="img-responsive pull-left gap-right" src="https://jmswaney.github.io/images/neuron_icon.png" width="30"/>             </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/category/research.html">Research</a></li>
                    <li><a href="/pages/publications.html">Publications</a></li>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/pages/contact.html">Contact</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->

<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://jmswaney.github.io/pystripe-summary.html"
                       rel="bookmark"
                       title="Permalink to Pystripe: a Python Package for Removing Streaks from Light-Sheet Images">
                        Pystripe: a Python Package for Removing Streaks from Light-Sheet Images
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-05-11T14:10:00-04:00"> Fri 11 May 2018</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://jmswaney.github.io/tag/pystripe.html">pystripe</a>
        /
	<a href="https://jmswaney.github.io/tag/python.html">python</a>
        /
	<a href="https://jmswaney.github.io/tag/microscopy.html">microscopy</a>
        /
	<a href="https://jmswaney.github.io/tag/light-sheet.html">light-sheet</a>
        /
	<a href="https://jmswaney.github.io/tag/spim.html">SPIM</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <div class="section" id="the-problem-streaks-in-light-sheet-fluorescence-microscopy">
<h2>The Problem: Streaks in Light-Sheet Fluorescence Microscopy</h2>
<p>Light-sheet fluorescence microscopy (<a class="reference external" href="https://en.wikipedia.org/wiki/Light_sheet_fluorescence_microscopy">LSFM</a>) is a high-speed imaging technique
that is gaining popularity in biological imaging. LSFM actually has many different
types of subtechnologies, such as selective plane illumination microscopy (SPIM).
In SPIM, a light-sheet is artificially created by quickly scanning a laser across
the field of view using a galvo mirror.</p>
<div class="figure align-center" style="width: 70%">
<img alt="spim-vs-confocal" src="images/spim_vs_confocal.jpg" />
<p class="caption">From Bruker and Newswire.</p>
<div class="legend">
(Left) SPIM illuminates a single plane of the sample at a time, reducing the
potential for fluorophore bleaching. The detection is performed using wide-field
cameras, which is faster than point scanning. (Right) Confocal single-photon
excitation illuminates the entire sample along the axial dimension.
Only a single pixel within the focal plane is recorded at a time.</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>While SPIM has many advantages over confocal, it has some complications that
do not exist in confocal microscopy. Due to wide-field detection, achieving a
flat field image is more challenging with SPIM. Such perfect illumination may
not even be possible without adaptive optical elements. A common manifestation
of this is seen when a sample of uneven refractive index is imaged using SPIM.
The small changes in refractive index within the sample scatter the light-sheet,
resulting in streaks and cast shadows. Some microscopes try to compensate for
this as well as laser attenuation by using illumination &quot;arms&quot; on both sides
of the sample. While this may drastically reduce cast shadows near the sample
surface, it cannot compensate for scattering near the core of large samples.</p>
<p>Here is an example of this streaking artifact from our lab's SPIM:</p>
<div class="figure align-center" style="width: 70%">
<img alt="streaky-image" src="images/streaky_image.jpg" />
<p class="caption">Raw mouse brain image using SPIM</p>
</div>
</div>
<div class="section" id="the-solution-pystripe">
<h2>The Solution: Pystripe</h2>
<p>There is still valuable, biologically-relevant information in the midst of the
stripe artifacts. Any filtering that we perform to remove the stripes should
selectively remove the stripes rather than our &quot;true&quot; signal. So the question
is how do we filter the streaks without disrupting the underlying signal?</p>
<p>In order to filter the stripes from the image, we need a method for isolating
that part of the original signal. We can first notice that the stripes are always
approximately horizontal. This is due to the fact that the illumination light
path is oriented horizontally across the field of view.</p>
<p>We can exploit the stripe characteristics in our filtering strategy. To
use the fact that all stripes are oriented horizontally, we can use the
discrete wavelet transform (DWT). If we apply the DWT once, the original
image is decomposed into four images at 1/4 the original resolution (same overall
number of coefficients): a downsampled &quot;approximation&quot; image and three detail
coefficient images (horizontal, vertical, and diagonal). These images large
obtained via a decimated filter bank. We can continue to apply the DWT to the
approximation image, resulting in another decomposition &quot;level&quot;. Since the
approximation image was downsampled, the same wavelet basis functions span a
larger physical length. That is, subsequent DWT levels focus on larger spatial
scales.</p>
<p>Since the stripes manifest as horizontal fluctuations in intensity, their
power spectrum will be mostly oriented vertically. We could apply a notch
filter without performing the DWT (while preserving the DC component), but
this wouldn't take advantage of the spatial decomposition that the DWT offers.
Therefore, a simple FFT filter will probably remove more of the original signal
than a combination DWT-FFT based filter.</p>
<p>To combine an FFT filter with our DWT decomposition, we can use the same FFT
notch filter on the horizontal detail coefficients. In this case, we need not
preserve the DC component of the DWT coefficients because the approximation
image contains most of that information. Since the stripes are not perfectly
horizontal, the filter should have some tunable <em>bandwidth</em> to adjust how
far from the vertical axis we filter the power spectrum. In my case, I used a
guassian filter where the standard deviation represented the bandwidth.</p>
<p>The result is shown below side-by-side with the original image:</p>
<div class="figure align-center" style="width: 90%">
<img alt="streaks-before-after" src="images/streaks_before_after.jpg" />
<p class="caption">Raw (left) and filtered (right) mouse brain image using SPIM and pystripe</p>
</div>
<p>In implementing pystripe, I've created a command-line interface (CLI) so that
multiple images in a directory can be batch processed using all the cores on
a single machine. In our lab, we can destripe a whole mouse brain (about 150 GB
of image data) in about 30 minutes. In <a class="reference external" href="https://aip.scitation.org/doi/full/10.1063/1.5016546">a similar method</a>, MATLAB code based on
the <a class="reference external" href="https://en.wikipedia.org/wiki/Contourlet">countourlet transform</a> took just about as long for a single image, so this
performance was a huge improvement.</p>
</div>

            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jmswaney-github-io'; // required: replace example with your forum shortname

                var disqus_url = 'https://jmswaney.github.io/pystripe-summary.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Justin Swaney
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                <p><small>  <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en">Creative Commons Attribution-NonCommercial 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://jmswaney.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://jmswaney.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://jmswaney.github.io/theme/js/respond.min.js"></script>


    <script src="https://jmswaney.github.io/theme/js/bodypadding.js"></script>
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jmswaney-github-io'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->


        <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ac0f7e62eb46c7e"></script>
</body>
</html>